# Ozon Seller Analytics Bot

Telegram Mini App для анализа продаж и бизнес-показателей продавцов на маркетплейсе Ozon.

## Функциональность

- **Аутентификация**: Безопасное хранение API-токенов Ozon через Telegram бота
- **Управление товарами**: Просмотр списка товаров, редактирование себестоимости
- **Аналитика продаж**: Расчет прибыли, маржинальности и ROI по каждому товару
- **ABC-анализ**: Классификация товаров по их вкладу в общую прибыль
- **Виджет "Товар дня"**: Отображение самого прибыльного товара
- **Уведомления**: Настройка уведомлений о низкой маржинальности и ROI
- **Ежедневные отчеты**: Автоматическая отправка сводок по продажам

## Технический стек

### Фронтенд
- React с TypeScript
- Material UI для компонентов интерфейса
- Telegram Web App API для интеграции с Telegram

### Бэкенд
- Python с FastAPI
- SQLite для хранения данных
- python-telegram-bot для работы с Telegram Bot API
- aiohttp для асинхронной работы с Ozon API

## Структура проекта

```
ozon-bot/
├── backend/
│   ├── app.py         # FastAPI приложение
│   ├── bot.py         # Telegram бот
│   └── config.py      # Конфигурация бэкенда
└── frontend/
    └── ozon-web/      # React приложение
        ├── public/
        └── src/
            ├── components/  # React компоненты
            ├── utils/       # Вспомогательные функции
            ├── App.tsx      # Основной компонент приложения
            └── index.tsx    # Точка входа
```

## Улучшения версии 2.0

В версии 2.0 внесены существенные улучшения, повышающие точность аналитики и производительность приложения:

## 1. Улучшенные формулы аналитики

- **Учёт рекламных затрат**: добавлен учёт затрат на рекламу через Ozon API (`/v1/finance/campaign`)
- **Учёт возвратов**: обработка данных о возвратах через API (`/v3/returns/company/fbs`)
- **Обновленные формулы расчёта**:
  ```
  total_costs = (cost * sales_count) + commission + ad_cost + return_cost
  profit = revenue - total_costs
  margin = (profit / revenue) * 100
  roi = (profit / total_costs) * 100
  ```

## 2. Надежный планировщик задач (Celery + Redis)

- Замена встроенного асинхронного планировщика на Celery
- Использование Redis в качестве брокера сообщений
- Настроенное расписание задач:
  - Обновление данных каждую ночь в 02:00
  - Отправка ежедневных отчётов в 09:00
  - Проверка метрик каждые 3 часа
- Отказоустойчивость и повторные попытки при ошибках

## 3. Оптимизированная пагинация

- **Серверная пагинация** для работы с большими объёмами данных (>1000 товаров)
- Настраиваемое количество товаров на странице (10, 20, 50, 100)
- Оптимизированный интерфейс с информацией о текущем диапазоне
- Улучшенные фильтры для быстрого поиска нужных товаров

## Установка и запуск

### Требования

- Python 3.9+
- Node.js 16+
- Redis 6+ (для Celery)

### Установка зависимостей

```bash
# Установка Python зависимостей
pip install -r requirements.txt

# Установка фронтенд зависимостей
cd frontend/ozon-web
npm install
```

### Запуск Celery

```bash
# Запуск Celery Worker (в отдельном терминале)
celery -A backend.celery_app worker --loglevel=info

# Запуск Celery Beat для планировщика (в отдельном терминале)
celery -A backend.celery_app beat --loglevel=info
```

### Запуск сервера

```bash
# Запуск FastAPI сервера
cd backend
uvicorn app:app --reload
```

### Запуск фронтенда (для разработки)

```bash
cd frontend/ozon-web
npm run dev
```

## Интеграция с Telegram

1. Создайте бота через @BotFather и получите токен
2. Настройте команды бота через @BotFather:
   ```
   start - Начать работу с ботом
   set_token - Установить API токены Ozon
   status - Проверить статус API токенов
   update_data - Обновить данные из Ozon API
   delete_tokens - Удалить API токены
   notifications - Настройки уведомлений
   help - Показать справку
   ```

3. Добавьте мини-приложение к боту:
   - В @BotFather выберите `/mybots`
   - Выберите вашего бота
   - Выберите "Bot Settings" > "Menu Button" > "Configure menu button"
   - Введите URL веб-приложения и сохраните

## Получение токенов Ozon API

1. Войдите в личный кабинет Ozon Seller
2. Перейдите в раздел "Настройки" > "API"
3. Получите Client ID и API Key (токен)

## Автор

Антон Марухин

## Лицензия

MIT 